services:
- docker

env:
  global:
  - secure: "a/IAtWSXI+jUIQh27B5mNO7bxxCOB2gcB5R5+bQnGb8T+5ZrFxygLsjDiSU/RehD4HTBIfoNoHXkgPYRI6+YvZOnPFDKrYKkW/Wk4YmlGTx77+U9e0SZcMYL8fAK5zj5xrjN/kVO/rTkBuiOzxgKrbu0cTJiIEP7P3QZwPo87QGTy3prQT9yKxbYWSFmqrQgwe3BBrQCFgYIIOOBJUx1adyjw6B/tAzEaGF5hn0cV/V1eMVluSGFjhsQBVJZbjXhLg5SqMQVvQkGqZEYHha3li06oXiejGja+bPmgCfWnReZK3FFO6QanXyKvenNLqJCRRLcf7apLrPCYXYRDvJjLJWVQ1L3BGw6DmFZ4R3T71JjbwHrDeeutJzRyJ36xM5GdFjz1Jq+Xp7DYuCYhbRSBbImvgLbsU3UHytTukDDYlo/wRp5X9A4GWj4IJM+2TFSFJkQk+RgVyC+DHSCzsDJBtJW/mO+I9MpliE/0pb0QsvaA8llOuBtu00HzE1Q/vb8RAm0e7TxvsiKoxWjJ+/GqbrbqE4kxINsw/spqb/d8Hl/uSF/M31J7ZgtrzFvJmdytHJOA7minp4nwrw297diksmGZquBoo6hMCZNPfuF7lkP9cVA5AAccGy4wmkjU3a0P8Omwd6r+K3CH/YZUBIdZNL7tn8uavECertwSDNi+cw="
  - secure: "SwGn9w7yO9yCyeJUfE8uaE5qbXYL/TqMExrIA1hHZs0Ie9+ww3sxo/KFJrpbl31caI8LturXbFNdylKjGlOo0viEHaw6JLg+A9WFa5RbjA1lp4LSoT9p7Sl/syrqOt2GFLsGM7Ya1AHbQWRYx8NwIcpvgcCK5d1xz+6DfPo3Gl0K6Xa1/UXww0aIHpbjbi4TK/JBbvKfP5dHG3Jv16H/a9CrV4hqwqxuy1C4t2N+43g5zTgO2npPbi2LAF4Vkf7lMIErYWlel+N+nI0X+MqI29d6MqGH0v7+8gkdRdnVaWK0Cb0BRveZ6xXLJT18NGNMnjKwompd5Y5kC6Xe8m2xHQbzgNncbE4NpC0y72j+APynWhf329euXwgAE1hHM9YUD6QiGsX7Bg8f7xGTmhAq18uZJidIndYAXQPYb2CSvxhOORB5ZIsleCPTqWC4fWtb/8Qm1xirawT+/vZLUDbRGchHSJp++nXEWOq9Cwf32gNh7yg5tgj73qKXQFBASHEA9iGfGk0GB1MseL6ba4rZTijGijaVbTvWWoq6XzC1F95c4uQFHd6Xrg09lJJ+PQWl+upXJT2XEVa9JHwdaArAM+vCOxruqmG4mh5LLLOvzjkr27XjqMryvyutwd8lhg5/LR1se8+RuZRzA9LIT8wBGPhbVV4cyhctIMbmOiSWCQg="
  - secure: "RRdrXyE22napOrA30aXV03rDZXwDmxpxvuDZZY+sGO1gdrZmws0/tqT+IqVAOnLc17CUcSWY/wCEQBXGeU2NexFvQPrhUSNkO9v92/EuyJC/aUfaYv/IlGEsRk++TUUF8ipEu5QNL+IOnUD30GK4/7xYo5yY3hdXDWuKnyW2Lv4X5x/uaNTBECtTs37w0D/n7BPUCvLR/Vm4sOtB0TvO17yz2W5lkl1L8dNEuJ1W66aEeCUjqdJlQ/insU7e9uzy3AR5PCEyvlHPD4I/rYh+DRaWceiyf/+P22UIAKdJPdYSGn4hTNAxG0hqCyblkzmAQTTJBe+BNb3I43BXASO0bjFnH+YrQ554nddXLu6YQmt3zrqnpZ2hxVik1oBBOpSX/TKfhhuYNPXN0wiVKsMx+vVHgXNl1ayGWbgELwPVsg4riAZfaENbbiRLkfeCV9N8SstHfyk+670/25FEbQFJz9BtCuH/gx0hImVl/Xpkc8sbYRmv3oatQzE5O+uWxjTRZXkjY1T0WI/ynKtovD4tg+bn7B/IIYAjrujKdsLzja3UhWoQyPA/xufhEOH7sQUuPKzmLox4Rv0V1/APwBlffz1xLkdvoUhClYfOaugac/kZVOcl3whNH65wvQiGdf/US/Ny2uQmOxs1k+nMrsUd+uuj/uQ1bHngeS2qQ/E3lp0="
  - secure: "fYxZZXHYY2UKtqy7qbiZWuNNTLuDeDRrGt0TUqLYm4UmNBBnOQfhZrMBPslhu74LC6Y5WIjBXI4rI7jKc8kSdTah82yxcNNLEuXE6VkfJFHxASSUyRZsOra4zAUqzrZ/CfpOGxomo3tgM734ioyJPo4gxoObLBqKH1lcXtbfmb1VhRWv86HirXveRCTAQaBLbzldGXK0nwgOsfCtU5fQJC5y5gmBpW33JAqKHBTemLqRtS+87txnICbuJlVMbUYUvCaOZPy+cJ6uIWJjZBehc6mswEiH6sBYCgNMj1KEl4omJdTEe2wKHWypCZnu4w3qDINZl7rr+THm0uTuo78K0mhUEa4C+ILcj3BxT1GGrBk3pv6/9wl7yV0emp5AVQ5wSW19E/pxeJace4Kw3qI7RABfuh35CvdYboxONnSKy4y3aoFkORuoeXcLp8C6RnJClsjLchFAhvmXInZ56bFx7sbwXvWVkxSkP0SIC0lbfe8rNbn7PTvXEpRSHVGRM/6dhH7PKRyOmmsvPuTQ5aCf6/b7gvym988Rj31sr54CWKJ4QYRKqeSfsEZDSWsRbT6NRjSsMVDBpMPH31uI+RSZuNndO62ueVa0r4DsjDSf735+d2cNtHPEto+GURJAIkow6l4Xdyatp7kCQ5tUl/58gqDWIXgu/oCOgsW0Z58Ek44="
  - secure: "kP5peDSNSOBxX1iIb1JsU4sJqf/1RVerEZl8/tGiJH5htYShT+qOgPI+GWoTOtx++nz7I05+VvLbloizN2uKbCc4/gH5HqsqBKLsLC5OLiSEaAq8Z3XJvcng1Gq2lWaM2xR1qk/EGwZJTx1QarRI1t97jkiFI3t9sReMUOrsHjAG77pgKFWTgp4u4kbEdgO7Eq3xzN2h+5T3mhypfX76sPXsg2tigVxPyODIQFf8VfGRwAJEN39GF8uL9spyW/V52oEBl5qrE6zZEJmLwqcZmkyzEbHTM1dI1vyEpWoW/cdDyBR7nwdiu8y8XrqvqGCSXquGTh0B3Vx/iHaq5gOsaacNm5RI47BQpLCA37BFciE4ENvxubRq45eN4sXeaqr210ODblDxG6xq8R25nLEmJC8jeV0MXbyuU10iJL5id0ZQMlDf9+9AfNQwUUwG3+Z5qQi2UL84R2fKAG2/i6CxWcUi/9VnqblCGb+AFunV/RAsVVmry/QiF1jxzZLcOHvvkLrNyW8/0pDD5nWX/Kh5gcwRe8Dq2YRdAoq9S7iPPiUgL/f8uwZdPNptJczfITDyv7o6ooat3rP6R38NueMR6MaG7pjzKzNklGzSTsH2RoxTryKeE+EOeQ/8BqkhJx6kyAMd87u2tiB65gtcXj26/s34kVpNUGV11cggbYVxA34="
  - secure: "fkIMpdB51cpOgehQo+AUthfJrxOIZWUu917F/7GpmjOxyPcVO16pROIlSiC6J1GY+o/5sD1r8bMP4LKCZ7rtBM4SUaGqEsDTwt8wPUvJy21JVxd5NCjkeJVWR3FNFzhzcg5dk/WTbZnAuOW88wWgay9NvAXFoDF/JJkkAj6Z1XrNZFcrDLfZDdDdRZUVzc02o1iJQTpnZAEG7c1Q3dEDmLRkg1ZmOZaMW+pIQuJBEGqK1tpzQSpxen5L7nzJCcb1cAMSOqTHrVEY2fCf/RS6fVedbXzJetdUbnGe0bWBpRghuIKaTozedsMlFmUiHaicNz0WAXj2nKUQTETiPWHXBaahbwjT8J1ElRBKU2QSvHQ/Gy6JqM7c0WtnqE4zXfDqplMzCtw3AcrqcUZBKO9qeT/XsNRNnHag3Q7S6OWDk4RfAmQpE6u0J9c74fRPQrr9YDLcgPqwRfsZs0aGtoIAHiqWXmeK6JV/m2U1+p6MzU/jFcq6E2UB0AP0s2FxIDf+Ch6sdSgPoqy5+jvjyFSHjxikaHjsqkFCCJuWfULzayxciOG8g72jvmU3mlwHCXUm3H6+p5JaDcONYQFQJPWeYaW8xvu1W/6sr8n/V/UcP/wXFhV0SAvtxkdrRanc3mt2fqj736Q72guSPklxYH9PFXZMeROMyejHhsGQKB+M/tc="

script:
- docker build --target test --tag todo-app:test .
- docker run todo-app:test todo_app/tests/test_trello.py
- docker run --env-file .env.test todo-app:test todo_app/tests/test_app.py
- docker run --env TRELLO_BOARD_ID --env TRELLO_AUTH --env TRELLO_TOKEN todo-app:test todo_app/tests_e2e/test_e2e.py
- echo $DOCKER_PASSWORD | docker login --username $DOCKER_USER --password-stdin
- docker build --target production --tag $DOCKER_USER/todo-app:latest .
- docker push $DOCKER_USER/todo-app:latest
- docker login --username=_ --password=$HEROKU_API_KEY registry.heroku.com
- docker tag $DOCKER_USER/todo-app:latest registry.heroku.com/lachlanpearse-todo-app/web
- docker push registry.heroku.com/lachlanpearse-todo-app/web
- heroku login
- heroku container:release web --app lachlanpearse-todo-app